import json

vuln_db = {}

def add_host():
    ip = input("Enter IP address: ")
    if ip not in vuln_db:
        vuln_db[ip] = {"ports": [], "vulnerabilities": []}
        print(f"[+] Host {ip} added.")
    else:
        print("[!] Host already exists.")

def add_port():
    ip = input("Enter IP address: ")
    port = int(input("Enter port: "))
    if ip in vuln_db:
        if port not in vuln_db[ip]["ports"]:
            vuln_db[ip]["ports"].append(port)
            print(f"[+] Port {port} added to {ip}.")
        else:
            print("[!] Port already exists.")
    else:
        print("[!] Host not found.")

def add_vulnerability():
    ip = input("Enter IP address: ")
    if ip in vuln_db:
        cve = input("Enter CVE ID (e.g., CVE-2023-1234): ")
        severity = input("Enter severity (low/medium/high): ")
        desc = input("Enter description: ")
        vuln = {"cve": cve, "severity": severity, "description": desc}
        vuln_db[ip]["vulnerabilities"].append(vuln)
        print(f"[+] Vulnerability added to {ip}.")
    else:
        print("[!] Host not found.")

def show_report():
    print("\n=== Vulnerability Report ===")
    for ip, data in vuln_db.items():
        print(f"\nHost: {ip}")
        print(f"  Open Ports: {', '.join(map(str, data['ports'])) or 'None'}")
        if data["vulnerabilities"]:
            print("  Vulnerabilities:")
            for v in data["vulnerabilities"]:
                print(f"    - {v['cve']} ({v['severity']}): {v['description']}")
        else:
            print("  No vulnerabilities.")

def save_data():
    with open("vuln_report.json", "w") as f:
        json.dump(vuln_db, f, indent=4)
    print("[+] Data saved to vuln_report.json")

def load_data():
    global vuln_db
    try:
        with open("vuln_report.json") as f:
            vuln_db = json.load(f)
        print("[+] Data loaded.")
    except FileNotFoundError:
        print("[!] No saved data found.")

def menu():
    while True:
        print("\n1. Add Host")
        print("2. Add Port")
        print("3. Add Vulnerability")
        print("4. Show Report")
        print("5. Save")
        print("6. Load")
        print("7. Exit")
        choice = input("Choose option: ")
        if choice == "1":
            add_host()
        elif choice == "2":
            add_port()
        elif choice == "3":
            add_vulnerability()
        elif choice == "4":
            show_report()
        elif choice == "5":
            save_data()
        elif choice == "6":
            load_data()
        elif choice == "7":
            print("Bye!")
            break
        else:
            print("Invalid option.")

menu()
